#!/bin/sh -e

mkdir -p te_pulse_hubbard_square/
cd te_pulse_hubbard_square
cp -rf ../te_ac_hubbard_square/output .

cat > stan.in <<EOF
model = "Hubbard"
method = "Time-Evolution"
lattice = "square"
a0w = 3
a0l = 0
a1w = 0
a1l = 3
t = 1.0
U = 10.0
nelec = 8
2Sz = 0
lanczos_max = 40
initial_iv = 1
EigenvecIO = "in"
dt = 0.01
tshift = 0.2
freq = 10.0
PumpType = "Pulse Laser"
VecPotW = 0.5
VecPotL = 0.5
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value: Flct
cat > reference.dat <<EOF
0.0000000000000000 7.9999999999999973 63.9999999999999787 0.2592919779061983 0.2991789411194007 0.0000000000000000 0.0000000000000000 0
0.0100000000000000 7.9999999999999583 63.9999999999996660 0.2592942648292668 0.2991836481968286 0.0000000000000000 0.0000000000000000 1
0.0200000000000000 8.0000000000000853 64.0000000000006821 0.2592938729783667 0.2991876327062922 0.0000000000000000 0.0000000000000000 2
0.0300000000000000 8.0000000000000018 64.0000000000000142 0.2592506187888699 0.2991351717445314 0.0000000000000000 0.0000000000000000 3
0.0400000000000000 8.0000000000000071 64.0000000000000568 0.2591378593578565 0.2989890478550579 0.0000000000000000 0.0000000000000000 4
0.0500000000000000 7.9999999999999458 63.9999999999995666 0.2589454505095349 0.2987348611279079 0.0000000000000000 0.0000000000000000 5
0.0600000000000000 8.0000000000000160 64.0000000000001279 0.2586812602075286 0.2983832387092726 0.0000000000000000 0.0000000000000000 6
0.0700000000000000 8.0000000000000000 64.0000000000000000 0.2583711035020358 0.2979697213489632 0.0000000000000000 0.0000000000000000 7
0.0800000000000000 7.9999999999998863 63.9999999999990905 0.2580570921216662 0.2975523226581429 0.0000000000000000 0.0000000000000000 8
0.0900000000000000 7.9999999999998961 63.9999999999991687 0.2577945189581117 0.2972069727628687 0.0000000000000000 0.0000000000000000 9
0.1000000000000000 8.0000000000000906 64.0000000000007248 0.2576475123890088 0.2970212442804246 0.0000000000000000 0.0000000000000000 10
0.1100000000000000 7.9999999999999227 63.9999999999993818 0.2576837870586332 0.2970868918141578 0.0000000000000000 0.0000000000000000 11
0.1200000000000000 7.9999999999999734 63.9999999999997868 0.2579688794793169 0.2974918047405225 0.0000000000000000 0.0000000000000000 12
0.1300000000000000 7.9999999999999618 63.9999999999996945 0.2585602861606382 0.2983119784566644 0.0000000000000000 0.0000000000000000 13
0.1400000000000000 8.0000000000000266 64.0000000000002132 0.2595019206879430 0.2996040643977222 0.0000000000000000 0.0000000000000000 14
0.1500000000000000 8.0000000000000639 64.0000000000005116 0.2608192792190336 0.3013989837665674 0.0000000000000000 0.0000000000000000 15
0.1600000000000000 8.0000000000000320 64.0000000000002558 0.2625156578240168 0.3036970046690790 0.0000000000000000 0.0000000000000000 16
0.1700000000000000 7.9999999999999334 63.9999999999994671 0.2645697064482362 0.3064646031156620 0.0000000000000000 0.0000000000000000 17
0.1800000000000000 7.9999999999999725 63.9999999999997797 0.2669345380054280 0.3096333624115887 0.0000000000000000 0.0000000000000000 18
0.1900000000000000 8.0000000000000462 64.0000000000003695 0.2695385398111625 0.3131011100631730 0.0000000000000000 0.0000000000000000 19
0.2000000000000000 7.9999999999999840 63.9999999999998721 0.2722879583501573 0.3167354349023037 0.0000000000000000 0.0000000000000000 20
0.2100000000000000 7.9999999999999982 63.9999999999999858 0.2750712454584811 0.3203796527723744 0.0000000000000000 0.0000000000000000 21
0.2200000000000000 7.9999999999999583 63.9999999999996660 0.2777650619589529 0.3238611796402345 0.0000000000000000 0.0000000000000000 22
0.2300000000000000 8.0000000000000480 64.0000000000003837 0.2802417321364583 0.3270021147149607 0.0000000000000000 0.0000000000000000 23
0.2400000000000000 8.0000000000000515 64.0000000000004121 0.2823778303285531 0.3296316323363547 0.0000000000000000 0.0000000000000000 24
0.2500000000000000 8.0000000000000675 64.0000000000005400 0.2840634644816397 0.3315995442212115 0.0000000000000000 0.0000000000000000 25
0.2600000000000000 7.9999999999999911 63.9999999999999289 0.2852117106010943 0.3327901533575186 0.0000000000000000 0.0000000000000000 26
0.2700000000000000 8.0000000000000444 64.0000000000003553 0.2857675607346067 0.3331353208884699 0.0000000000000000 0.0000000000000000 27
0.2800000000000000 8.0000000000000675 64.0000000000005400 0.2857156923233730 0.3326255571102631 0.0000000000000000 0.0000000000000000 28
0.2900000000000000 7.9999999999999547 63.9999999999996376 0.2850863652264183 0.3313179712653798 0.0000000000000000 0.0000000000000000 29
0.3000000000000000 8.0000000000000462 64.0000000000003695 0.2839588175806094 0.3293400978419376 0.0000000000000000 0.0000000000000000 30
0.3100000000000000 7.9999999999999885 63.9999999999999076 0.2824616685786018 0.3268889557533544 0.0000000000000000 0.0000000000000000 31
0.3200000000000000 8.0000000000000355 64.0000000000002842 0.2807700405004973 0.3242251524954308 0.0000000000000000 0.0000000000000000 32
0.3300000000000000 8.0000000000000586 64.0000000000004690 0.2790993675692610 0.3216623488870059 0.0000000000000000 0.0000000000000000 33
0.3400000000000000 7.9999999999999778 63.9999999999998224 0.2776961386354326 0.3195528652603140 0.0000000000000000 0.0000000000000000 34
0.3500000000000000 8.0000000000000675 64.0000000000005400 0.2768260908576358 0.3182705550838079 0.0000000000000000 0.0000000000000000 35
0.3600000000000000 8.0000000000000497 64.0000000000003979 0.2767605979148266 0.3181922409558987 0.0000000000000000 0.0000000000000000 36
0.3700000000000000 8.0000000000000373 64.0000000000002984 0.2777621496523723 0.3196789857613386 0.0000000000000000 0.0000000000000000 37
0.3800000000000000 8.0000000000000053 64.0000000000000426 0.2800698820231995 0.3230582877287946 0.0000000000000000 0.0000000000000000 38
0.3900000000000000 7.9999999999999734 63.9999999999997868 0.2838860824448462 0.3286080051161170 0.0000000000000000 0.0000000000000000 39
EOF
sed -e "1d" output/Flct.dat > flct.dat
paste flct.dat reference.dat > paste1.dat
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($2-$10)*($2-$10))} END{printf "%8.6f", diff}' paste1.dat`
diff=`awk 'BEGIN{diff='${diff}'} {diff+=sqrt(($3-$11)*($3-$11))} END{printf "%8.6f", diff}' paste1.dat`
diff=`awk 'BEGIN{diff='${diff}'} {diff+=sqrt(($4-$12)*($4-$12))} END{printf "%8.6f", diff}' paste1.dat`
diff=`awk 'BEGIN{diff='${diff}'} {diff+=sqrt(($5-$13)*($5-$13))} END{printf "%8.6f", diff}' paste1.dat`
diff=`awk 'BEGIN{diff='${diff}'} {diff+=sqrt(($6-$14)*($6-$14))} END{printf "%8.6f", diff}' paste1.dat`
diff=`awk 'BEGIN{diff='${diff}'} {diff+=sqrt(($7-$15)*($7-$15))} END{printf "%8.6f", diff}' paste1.dat`

test "${diff}" = "0.000000"
exit $?
